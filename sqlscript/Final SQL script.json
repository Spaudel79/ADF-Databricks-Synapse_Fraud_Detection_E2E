{
	"name": "Final SQL script",
	"properties": {
		"content": {
			"query": "-- =====================================================\n-- Azure Synapse Serverless SQL Pool - External Tables\n-- Complete Script for CSV, Parquet, and Delta formats\n-- =====================================================\n\n-- Step 1: Create Master Key (Required for credentials)\n-- Run this only once per database\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'YourStrongPassword123!';\n\n-- Step 2: Create External Data Source\nCREATE EXTERNAL DATA SOURCE externaldatasource\nWITH (\n    LOCATION = 'abfss://external-data-source@sepstoragegenz.dfs.core.windows.net'\n);\n\n-- =====================================================\n-- CSV FILE FORMAT AND EXTERNAL TABLE\n-- =====================================================\n\n-- Create External File Format for CSV\nCREATE EXTERNAL FILE FORMAT customerDataCSV\nWITH (\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS (\n        FIELD_TERMINATOR = ',',\n        STRING_DELIMITER = '\"',\n        FIRST_ROW = 2,\n        ENCODING = 'UTF8',\n        PARSER_VERSION = '2.0'\n    )\n);\n\n-- Create External Table for CSV Data\nCREATE EXTERNAL TABLE dbo.CustomerDataCSV (\n    CustomerID INT,\n    FirstName NVARCHAR(50),\n    LastName NVARCHAR(50),\n    Email NVARCHAR(100),\n    PhoneNumber NVARCHAR(20),\n    Address NVARCHAR(200),\n    City NVARCHAR(50),\n    State NVARCHAR(50),\n    ZipCode NVARCHAR(10),\n    Country NVARCHAR(50),\n    DateCreated DATE,\n    IsActive BIT\n)\nWITH (\n    LOCATION = '/csv-data/',\n    DATA_SOURCE = externaldatasource,\n    FILE_FORMAT = customerDataCSV\n);\n\n-- =====================================================\n-- PARQUET FILE FORMAT AND EXTERNAL TABLE\n-- =====================================================\n\n-- Create External File Format for Parquet\nCREATE EXTERNAL FILE FORMAT customerDataParquet\nWITH (\n    FORMAT_TYPE = PARQUET\n);\n\n-- Create External Table for Parquet Data\nCREATE EXTERNAL TABLE dbo.CustomerDataParquet (\n    CustomerID INT,\n    FirstName NVARCHAR(50),\n    LastName NVARCHAR(50),\n    Email NVARCHAR(100),\n    PhoneNumber NVARCHAR(20),\n    Address NVARCHAR(200),\n    City NVARCHAR(50),\n    State NVARCHAR(50),\n    ZipCode NVARCHAR(10),\n    Country NVARCHAR(50),\n    DateCreated DATE,\n    IsActive BIT\n)\nWITH (\n    LOCATION = '/parquet-data/',\n    DATA_SOURCE = externaldatasource,\n    FILE_FORMAT = customerDataParquet\n);\n\n-- =====================================================\n-- DELTA FILE FORMAT AND EXTERNAL TABLE\n-- =====================================================\n\n-- Create External File Format for Delta\nCREATE EXTERNAL FILE FORMAT customerDataDelta\nWITH (\n    FORMAT_TYPE = DELTA\n);\n\n-- Create External Table for Delta Data\nCREATE EXTERNAL TABLE dbo.CustomerDataDelta (\n    CustomerID INT,\n    FirstName NVARCHAR(50),\n    LastName NVARCHAR(50),\n    Email NVARCHAR(100),\n    PhoneNumber NVARCHAR(20),\n    Address NVARCHAR(200),\n    City NVARCHAR(50),\n    State NVARCHAR(50),\n    ZipCode NVARCHAR(10),\n    Country NVARCHAR(50),\n    DateCreated DATE,\n    IsActive BIT\n)\nWITH (\n    LOCATION = '/delta-data/',\n    DATA_SOURCE = externaldatasource,\n    FILE_FORMAT = customerDataDelta\n);\n\n-- =====================================================\n-- TEST QUERIES\n-- =====================================================\n\n-- Test CSV External Table\nSELECT TOP 10 * \nFROM dbo.CustomerDataCSV\nORDER BY CustomerID;\n\n-- Test Parquet External Table\nSELECT TOP 10 * \nFROM dbo.CustomerDataParquet\nORDER BY CustomerID;\n\n-- Test Delta External Table\nSELECT TOP 10 * \nFROM dbo.CustomerDataDelta\nORDER BY CustomerID;\n\n-- Performance Comparison Query\nSELECT \n    'CSV' as FileFormat,\n    COUNT(*) as RecordCount,\n    COUNT(DISTINCT Country) as UniqueCountries\nFROM dbo.CustomerDataCSV\nUNION ALL\nSELECT \n    'Parquet' as FileFormat,\n    COUNT(*) as RecordCount,\n    COUNT(DISTINCT Country) as UniqueCountries\nFROM dbo.CustomerDataParquet\nUNION ALL\nSELECT \n    'Delta' as FileFormat,\n    COUNT(*) as RecordCount,\n    COUNT(DISTINCT Country) as UniqueCountries\nFROM dbo.CustomerDataDelta;\n\n-- =====================================================\n-- ALTERNATIVE: Using OPENROWSET for Quick Testing\n-- =====================================================\n\n-- Test CSV files directly without external table\nSELECT TOP 5 *\nFROM OPENROWSET(\n    BULK 'csv-data/*.csv',\n    DATA_SOURCE = 'externaldatasource',\n    FORMAT = 'CSV',\n    PARSER_VERSION = '2.0',\n    FIRSTROW = 2,\n    FIELDTERMINATOR = ',',\n    ROWTERMINATOR = '\\n'\n) AS [CSVData];\n\n-- Test Parquet files directly\nSELECT TOP 5 *\nFROM OPENROWSET(\n    BULK 'parquet-data/*.parquet',\n    DATA_SOURCE = 'externaldatasource',\n    FORMAT = 'PARQUET'\n) AS [ParquetData];\n\n-- Test Delta files directly\nSELECT TOP 5 *\nFROM OPENROWSET(\n    BULK 'delta-data/',\n    DATA_SOURCE = 'externaldatasource',\n    FORMAT = 'DELTA'\n) AS [DeltaData];\n\n-- =====================================================\n-- CLEANUP COMMANDS (Use with caution!)\n-- =====================================================\n\n/*\n-- Drop External Tables\nDROP EXTERNAL TABLE IF EXISTS dbo.CustomerDataCSV;\nDROP EXTERNAL TABLE IF EXISTS dbo.CustomerDataParquet;\nDROP EXTERNAL TABLE IF EXISTS dbo.CustomerDataDelta;\n\n-- Drop External File Formats\nDROP EXTERNAL FILE FORMAT IF EXISTS customerDataCSV;\nDROP EXTERNAL FILE FORMAT IF EXISTS customerDataParquet;\nDROP EXTERNAL FILE FORMAT IF EXISTS customerDataDelta;\n\n-- Drop External Data Source\nDROP EXTERNAL DATA SOURCE IF EXISTS externaldatasource;\n*/",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "mydb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}